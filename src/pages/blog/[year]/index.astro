---
import path from "path";
import Layout from "../../../layouts/BaseLayout.astro";
import BlogPostList from "../../../components/BlogPostPage/List.astro";
import { getCollection } from "astro:content";
import getDirsInDir from "../../../utils/get-dirs-in-dir";

export async function getStaticPaths() {
    const dir = path.resolve(process.cwd(), "./src/content/blog/");
    const dirsInDir = getDirsInDir(dir);

    return dirsInDir.map((yearDir) => {
        return {
            params: { year: yearDir },
        };
    });
}

const posts = await getCollection("blog", ({ data }) => {
    if (data.redirect) {
        return false;
    }

    const { year } = Astro.params;

    return data.pubDate.getFullYear().toString() === year;
});
---

<Layout>
    <BlogPostList posts={posts} />
</Layout>

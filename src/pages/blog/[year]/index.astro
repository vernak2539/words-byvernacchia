---
import path from "path";
import Layout from "../../../layouts/BaseLayout.astro";
import BlogPostList from "../../../components/BlogPostPage/List.astro";
import { getCollection } from "astro:content";
import getDirsInDir from "../../../utils/get-dirs-in-dir";

export async function getStaticPaths() {
    const dir = path.resolve(process.cwd(), "./src/content/blog/");
    const dirsInDir = getDirsInDir(dir);

    return dirsInDir.map((yearDiretory) => {
        return {
            params: { year: yearDiretory },
        };
    });
}

const { year } = Astro.params;

const allPosts = await getCollection("blog");
const posts = allPosts
    .filter((post) => !post.data.redirect)
    .filter((post) => {
        return post.data.pubDate.getFullYear().toString() === year;
    });
---

<Layout>
    <BlogPostList posts={posts} />
</Layout>
